\begin{section}{System Models and Architecture}
	
\label{sec:modeling}
In this section, the system dynamical, noise, and disturbance models used for control and motion plannign are described. We also introduce the adaptive control model that will be used later on in our approach in Section \ref{sec:Res_adapt_control}.

% Bold letters only for vectors
% Approach

\subsection{Vehicle Model}
In this work we consider a differential-drive ground vehicle model \cite{nutaro2011building} whose continuous-time dynamics can be described as:
%    \begin{align}
%        \dot{v}=\begin{cases}
%            \frac{1}{m}(F_l+F_r-(B_s+B_r)v), & \text{if turning},\\
%            \frac{1}{m}(F_l+F_r-B_rv), & \text{if not turning},
%        \end{cases} \\
%        \dot{\omega}=\begin{cases}
%            \frac{1}{I_z}(\frac{B}{2}(F_l-F_r)-B_l\omega), &\text{if turning},\\
%            0, & \text{if not turning}, 
%        \end{cases}
%	\end{align}
%	\begin{align}
%        \dot{\theta_h}=\omega, \dot{x}=v\sin(\theta_h), \dot{y}=v\cos(\theta_h).
%	\end{align}

	\begin{equation}
    \begin{split}
    \label{eqn:plant}
    \dot{v}&=\left\{
    \begin{array}{ll}
    \frac{1}{m}(F_l+F_r-(B_s+B_r)v, & \hbox{if } turning\\
    \frac{1}{m}(F_l+F_r-B_rv, & \hbox{if } not~turning
    \end{array}
    \right.\\
    \dot{\omega}&=\left\{
    \begin{array}{ll}
    \frac{1}{I_z}(\frac{B}{2}(F_l-F_r)-B_l\omega, & \hbox{if } turning\\
    0, & \hbox{if } not~turning
    \end{array}
    \right.\\
    \end{split}
    \end{equation}
    \begin{align}
     \dot{\theta_h}=\omega,\text{ } \dot{x}=v\sin(\theta_h),\text{ } \dot{y}=v\cos(\theta_h).
	\end{align}
	
in which $x$ and $y$ coordinates represent position, $\theta_h$ represents the vehicle's heading
% angle measured from the positive $x$ axis, 
 and $v$ is the speed in this direction of motion. $F_l$ and $F_r$ describe the left and right forces from the wheels, while $B_r$ is the mechanical resistance of the wheels to rolling. 
% If the assumption is that the wheels do not slip.
This presents a high-level model of the vehicle, describing only the motion equations. Both forces, $F_l$ and $F_r$, are considered as inputs to the system, are derived from the motors, gearbox, and wheels. All of the resistive parameters, mass, and moment of inertia $I_z$ are able to change to unknown future values as damage, system degradation, and environmental changes occur. The above system model may be rewritten in a continuous-time state space form,
    \begin{equation}
	\dot{\bm{x}}(t) = \bm{A}(t)\bm{x}(t) + \bm{B}(t)\bm{u}(t)
	\end{equation}
with the state matrix $\bm{A}(t) \in \R^{n\times n}$, the input matrix $\bm{B}(t) \in \R^{n\times m}$, state vector $\bm{x}(t) \in \R^{n}$, and system input $\bm{u}(t) \in \R^{m}$. $\bm{A}(t)$, $\bm{B}(t)$, $\bm{x}(t)$, and $\bm{u}(t)$ are given by:

%    \begin{equation}
%	\bm{A}_v(t)=\begin{bmatrix} 1 & 0 & cos(\theta_h) \\ 0 & 1 & sin(\theta_h) \\ 0 & 0 & -(B_s+B_r) \end{bmatrix},
%	\bm{B}_v(t)=\begin{bmatrix} 0 \\ 0 \\ \frac{1}{m} \end{bmatrix}, \nonumber
%	\end{equation}
%	\begin{equation}
%     \bm{x}_v(t)=\begin{bmatrix} x \\ y \\ v \end{bmatrix}, \bm{u}_v(t)= F_l+F_r 
%	\end{equation}
%The angle model for steering is written as:
%	\begin{equation}
%	\bm{A}_{\theta}(t)=\begin{bmatrix} 0 & 1 \\ 0 & -B_l \end{bmatrix} \nonumber
%	\bm{B}_{\theta}(t)=\begin{bmatrix} 0 \\ \frac{B}{2I_z} \end{bmatrix},
%	\end{equation}
%    \begin{equation}
%     \bm{x}_{\theta}(t)=\begin{bmatrix} \theta_h \\ \dot{\theta_h} \end{bmatrix}, \bm{u}_{\theta}(t)=F_l-F_r 
%	\end{equation}
%For either system, a general state space model is written in the form,
%    \begin{equation}
%	\dot{\bm{x}}(t) = \bm{A}(t)\bm{x}(t) + \bm{B}(t)\bm{u}(t)
%	\end{equation}

    \begin{equation}
	\bm{A}(t)=\begin{bmatrix} 0 & 0 & cos(\theta_h) & 0 & 0\\ 0 & 0 & sin(\theta_h) & 0 & 0 \\ 0 & 0 & -(B_s+B_r) & 0 & 0 \\ 0 & 0 & 0 & 0 & 1 \\ 0 & 0 & 0 & 0 & -B_l \end{bmatrix} \nonumber
	\end{equation}
	\begin{equation}
	\bm{B}(t)=\begin{bmatrix} 0 & 0 \\ 0 & 0 \\ \frac{1}{m} & 0 \\ 0 & 0 \\ 0 & \frac{B}{2I_z} \end{bmatrix}, 
     \bm{x}(t)=\begin{bmatrix} x \\ y \\ v \\ \theta_h \\ \dot{\theta_h} \end{bmatrix}, \bm{u}(t)= \begin{bmatrix} F_l+F_r \\ F_l-F_r  \end{bmatrix}  \nonumber
	\end{equation}



\subsection{Adaptive Control Model}
In this work we leverage the \textit{Characteristic Model Based All-coefficient Adaptive Control} approach presented in \cite{4106038} in which the objective is to compute an input to have the system follow a reference model given changing dynamics (i.e. dynamic $\bm{A}$ and  $\bm{B}$). Here we summarize the model which will be used later in Section \ref{sec:Res_adapt_control} to adapt the system under uncertainties and to detect attacks. The dynamically changing model is linearized to a defined set point from initially known parameters within the $\bm{A}$ and $\bm{B}$ matrices:
	\begin{equation}
	\dot{\bm{x}}(t) = \bm{A}\bm{x}(t) + \bm{B}\bm{u}(t)
	\end{equation}
Since the adaptive control algorithm used is based on a discrete-time state space model, the continuous-time model needs to be discritized. With a suitable sampling time $t_s$, the linearized discrete-time model is written as,
    \begin{equation}
	\bm{x}(k+1) = \bm{A}_d\bm{x}(k) + \bm{B}_d\bm{u}(k)
	\end{equation}
	\begin{equation}
	y(k)=\bm{C}\bm{x}(k)
	\end{equation}
with $y(k)$ is described as a generalized scalar output of the system, the output matrix is defined as $\bm{C} \in \R^{n}$, while $\bm{A}_d \in \R^{n\times n}$ and $\bm{B}_d \in \R^{n\times m}$ retain the same dimensions as the continuous-time case. The state space model's discrete-time transfer function is,
% 	\begin{align}
% 	\begin{split}
% 	\label{eq:transfer_function}
%         G(z) & = \frac{y(z)}{u(z)} = \bm{C}(z\bm{I}-\bm{A}_d)^{-1}\bm{B}_d  \\
% 	& = \frac{b_0z^{n-d}+b_1z^{n-d-1} +...+b_mz^{n-d-m}}{z^{n}+a_1z^{n-1}+...+a_{n-1}z+a_n} 
% 	\end{split}
% 	\end{align}
% with $b_0\ne{0}$, $d>0$, $n-d-m\geq{0}$, $n$ and $m$ are orders of the transfer function's denominator and numerator, and $d$ is the system delay. 

% Using an Autoregressive Moving Average (ARMA) model and defining the operators $q^{-1}$ (delay) and $q$ (advance),
% 	\begin{equation}
% 	q^{-1}x(k) = x(k-1), \;\;qx(k) = x(k+1)
% 	\end{equation}
% the system (\ref{eq:transfer_function}) is now expressed as:
%     \begin{align}
%     \begin{split}
%     \label{ARMA_equation}
% 	(1+&a_1q^{-1}+...+a_nq^{-n})y(k) \\
% 	&=q^{-d}(b_0+b_1q^{-1}+...+b_mq^{-m})u(k)
% 	\end{split}
% 	\end{align}
% Now, by defining from \eqref{ARMA_equation}, 
% 	\begin{equation}
% 	\label{eq:A_q}
% 	A(q^{-1})=(1+a_1q^{-1}+...+a_nq^{-n})
% 	\end{equation}
% 	\begin{equation}
% 	\label{eq:B_prime}
% 	B^{'}(q^{-1})=(b_0+b_1q^{-1}+...+b_mq^{-m})
% 	\end{equation}
% we can revise \eqref{ARMA_equation} to the system expressed as:
% 	\begin{equation}
% 	\label{eq:ARMA_equation_revise}
% 	A(q^{-1})y(k)=q^{-d}B^{'}(q^{-1})u(k)
% 	\end{equation}
% We want to design an input signal $u(k)$ that ensures our system's output $y(k)$ tracks $y^*(k)$ from the reference model, with a given input reference signal $r(k)$. This reference model is expressed as,
% 	\begin{equation}
% 	\label{eq:reference model_q}
% 	E(q^{-1})y^*(k+d)=q^{-d}gH(q^{-1})r(k)
% 	\end{equation}
% with,
%     \begin{equation}
%     \label{eq:E_q}
% 	E(q^{-1})=1+e_1q^{-1}+ \dots +e_wq^{-w}
% 	\end{equation}
% 	\begin{equation}
% 	H(q^{-1})=1+h_1q^{-1}+ \dots +h_{w-1}q^{-w+1}
% 	\end{equation}


%%%%%%%%%%%%%%%%%%%%%%%% Beginning of Change %%%%%%%%%%%%%%%%%%%%%%%


	\begin{align}
	\begin{split}
	\label{eq:transfer_function}
        G(z) & = \frac{y(z)}{u(z)} = \bm{C}(z\bm{I}-\bm{A}_d)^{-1}\bm{B}_d  \\
	& = \frac{b_0z^{p-d}+b_1z^{p-d-1} +...+b_mz^{p-d-q}}{z^{p}+a_1z^{p-1}+...+a_{p-1}z+a_p} 
	\end{split}
	\end{align}
with $b_0\ne{0}$, $d>0$, $p-d-q\geq{0}$, $p$ and $q$ are orders of the transfer function's denominator and numerator, and $d$ is the system delay. From \eqref{eq:transfer_function}, the system can be expressed as:
    \begin{align}
    \begin{split}
    \label{ARMA_equation}
	(1+&a_1z^{-1}+...+a_pz^{-p})y(k) \\
	&=z^{-d}(b_0+b_1z^{-1}+...+b_qz^{-q})u(k)
	\end{split}
	\end{align}
Now, by defining from \eqref{ARMA_equation}, 
	\begin{equation}
	\label{eq:A_q}
	A(z^{-1})=(1+a_1z^{-1}+...+a_pz^{-p})
	\end{equation}
	\begin{equation}
	\label{eq:B_prime}
	B^{'}(z^{-1})=(b_0+b_1z^{-1}+...+b_qz^{-q})
	\end{equation}
we can revise \eqref{ARMA_equation} to the system expressed as:
	\begin{equation}
	\label{eq:ARMA_equation_revise}
	A(z^{-1})y(k)=z^{-d}B^{'}(z^{-1})u(k)
	\end{equation}
We want to design an input signal $u(k)$ that ensures our system's output $y(k)$ tracks $y^*(k)$ from the reference model, with a given input reference signal $r(k)$. This reference model is expressed as,
	\begin{equation}
	\label{eq:reference model_q}
	E(z^{-1})y^*(k+d)=z^{-d}gH(z^{-1})r(k)
	\end{equation}
with,
    \begin{equation}
    \label{eq:E_q}
	E(z^{-1})=1+e_1z^{-1}+ \dots +e_wz^{-w}
	\end{equation}
	\begin{equation}
	H(z^{-1})=1+h_1z^{-1}+ \dots +h_{w-1}z^{-w+1}
	\end{equation}


%%%%%%%%%%%%%%%%%%%%%%%%%% END OF CHANGE %%%%%%%%%%%%%%%%%%%%%%%%%%%


This creates a stable model reference transfer function in the form:
	\begin{equation}
	\label{eq:reference model_z}
	\frac{y^*(z)}{r(z)}=\frac{z^{-d}gH(z^{-1})}{E(z^{-1})}
	\end{equation}
The variable $g$ is a constant to ensure a 1:1 steady state ratio of the reference $r$ and tracking signal $y^*$.


 \subsection{Noise and Disturbance Model}
When a ground vehicle is in motion, there are many factors that may cause it to behave differently. These factors can include sensor or actuator noises and actuator failure, as well as external influences like wind disturbance, and changing ground surfaces. The uncertainties from actuator noise are due to mechanical uncertainties of motors and gears, which are represented by $ \bm{\eta}_a \in \mathcal{N}(0,\sigma_a) $, while any disturbances are described as $\bm{d}(k)$. The output uncertainty vectors due to measurement noise and sensor attacks is described by $ \bm{\eta}_s \in \mathcal{N}(0,\sigma_s) $ and $\bm{\xi}(k)$, respectively. All noises are assumed to have a zero mean Gaussian distribution. The overall discretized system model accounting for noise, disturbance, and attack effects  can be described in in the following form:
    \begin{equation}
	\bm{x}(k+1)=\bm{A}(k)\bm{x}(k)+\bm{B}(k)\bm{u}(k)+\bm{\eta}_a(k)+\bm{d}(k)
	\end{equation}
	\begin{equation}
	\bm{y}(k)=\bm{C}\bm{x}(k)+\bm{\eta}_s(k)+\bm{\xi}(k)
	\end{equation}
The vector $\bm{y}(k) \in \R^{s}$ is described as the sensor measurement vector of $s$ sensor measurements and the output matrix is defined as $\bm{C} \in \R^{s\times n}$.  

\end{section}